/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as u,jsxs as P}from"@dropins/tools/preact-jsx-runtime.js";import{c as C,a as w,s as x}from"../chunks/klaviyoCheckoutConsentApi.js";import{classes as v}from"@dropins/tools/lib.js";import*as b from"@dropins/tools/preact-compat.js";import{Suspense as L,lazy as r,useState as $,useRef as S}from"@dropins/tools/preact-compat.js";import{useState as k,useEffect as T}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/fetch-graphql.js";const V=e=>b.createElement("svg",{id:"Icon_Check_Base","data-name":"Icon \\u2013 Check \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},b.createElement("g",{id:"Large"},b.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),b.createElement("g",{id:"Check_icon","data-name":"Check icon",transform:"translate(303.874 1434.583)"},b.createElement("path",{vectorEffect:"non-scaling-stroke",id:"Path_884137","data-name":"Path 884137",d:"M148,494.611l4.248,4.244,8.538-8.522",transform:"translate(-446.265 -1917.177)",fill:"none",stroke:"currentColor"})))),U=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"})),j=function(){const n=typeof document<"u"&&document.createElement("link").relList;return n&&n.supports&&n.supports("modulepreload")?"modulepreload":"preload"}(),N=function(e){return"/"+e},O={},i=function(n,s,a){let d=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));d=Promise.allSettled(s.map(t=>{if(t=N(t),t in O)return;O[t]=!0;const o=t.endsWith(".css"),m=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${m}`))return;const f=document.createElement("link");if(f.rel=o?"stylesheet":j,o||(f.as="script"),f.crossOrigin="",f.href=t,c&&f.setAttribute("nonce",c),document.head.appendChild(f),o)return new Promise((h,E)=>{f.addEventListener("load",h),f.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${t}`)))})}))}function _(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return d.then(l=>{for(const c of l||[])c.status==="rejected"&&_(c.reason);return n().catch(_)})},B=e=>e.reduce((s,a)=>{if(!a)return s;if(typeof a=="string"&&(s+=` ${a}`),Array.isArray(a)){const[d,_]=a;d&&_&&(s+=` ${d}`)}return s},"").trim(),R={Add:r(()=>i(()=>import("../chunks/Add.js"),[])),Bulk:r(()=>i(()=>import("../chunks/Bulk.js"),[])),Burger:r(()=>i(()=>import("../chunks/Burger.js"),[])),Cart:r(()=>i(()=>import("../chunks/Cart.js"),[])),Check:r(()=>i(()=>Promise.resolve().then(()=>U),void 0)),ChevronDown:r(()=>i(()=>import("../chunks/ChevronDown.js"),[])),ChevronUp:r(()=>i(()=>import("../chunks/ChevronUp.js"),[])),ChevronRight:r(()=>i(()=>import("../chunks/ChevronRight.js"),[])),Close:r(()=>i(()=>import("../chunks/Close.js"),[])),Heart:r(()=>i(()=>import("../chunks/Heart.js"),[])),Minus:r(()=>i(()=>import("../chunks/Minus.js"),[])),Placeholder:r(()=>i(()=>import("../chunks/Placeholder.js"),[])),PlaceholderFilled:r(()=>i(()=>import("../chunks/PlaceholderFilled.js"),[])),Search:r(()=>i(()=>import("../chunks/Search.js"),[])),SearchFilled:r(()=>i(()=>import("../chunks/SearchFilled.js"),[])),Sort:r(()=>i(()=>import("../chunks/Sort.js"),[])),Star:r(()=>i(()=>import("../chunks/Star.js"),[])),View:r(()=>i(()=>import("../chunks/View.js"),[])),User:r(()=>i(()=>import("../chunks/User.js"),[])),Warning:r(()=>i(()=>import("../chunks/Warning.js"),[])),Locker:r(()=>i(()=>import("../chunks/Locker.js"),[])),Wallet:r(()=>i(()=>import("../chunks/Wallet.js"),[])),Card:r(()=>i(()=>import("../chunks/Card.js"),[])),Order:r(()=>i(()=>import("../chunks/Order.js"),[])),Delivery:r(()=>i(()=>import("../chunks/Delivery.js"),[])),OrderError:r(()=>i(()=>import("../chunks/OrderError.js"),[])),OrderSuccess:r(()=>i(()=>import("../chunks/OrderSuccess.js"),[])),PaymentError:r(()=>i(()=>import("../chunks/PaymentError.js"),[])),CheckWithCircle:r(()=>i(()=>import("../chunks/CheckWithCircle.js"),[])),WarningWithCircle:r(()=>i(()=>import("../chunks/WarningWithCircle.js"),[])),WarningFilled:r(()=>i(()=>import("../chunks/WarningFilled.js"),[])),InfoFilled:r(()=>i(()=>import("../chunks/InfoFilled.js"),[])),HeartFilled:r(()=>i(()=>import("../chunks/HeartFilled.js"),[])),Trash:r(()=>i(()=>import("../chunks/Trash.js"),[])),Eye:r(()=>i(()=>import("../chunks/Eye.js"),[])),EyeClose:r(()=>i(()=>import("../chunks/EyeClose.js"),[])),Date:r(()=>i(()=>import("../chunks/Date.js"),[])),AddressBook:r(()=>i(()=>import("../chunks/AddressBook.js"),[])),EmptyBox:r(()=>i(()=>import("../chunks/EmptyBox.js"),[])),Coupon:r(()=>i(()=>import("../chunks/Coupon.js"),[])),Gift:r(()=>i(()=>import("../chunks/Gift.js"),[])),GiftCard:r(()=>i(()=>import("../chunks/GiftCard.js"),[])),Edit:r(()=>i(()=>import("../chunks/Edit.js"),[]))};function A(e){try{if(e.startsWith("//")){const s=`${window.location.protocol}${e}`;return new URL(s).hostname!==window.location.hostname?(console.error(`[Icon] External URL rejected for security: ${e} - Only same-domain URLs are allowed`),!1):!0}return new URL(e).hostname!==window.location.hostname?(console.error(`[Icon] External URL rejected for security: ${e} - Only same-domain URLs are allowed`),!1):!0}catch{return console.error(`[Icon] Invalid URL format: ${e}`),!1}}function W({url:e,...n}){const[s,a]=k(""),[d,_]=k(!0),[l,c]=k(!1);return T(()=>{fetch(e).then(t=>{if(!t.ok)throw console.error(`[Icon] Failed to fetch SVG: ${t.status} ${t.statusText}`),l;return t.text()}).then(t=>{try{if(!new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg"))throw new Error("No <svg> element found")}catch(m){m instanceof Error?console.error(`[Icon] Invalid SVG content from ${e}: ${m.message}`):console.error(`[Icon] Invalid SVG content from ${e}: ${String(m)}`),c(!0),_(!1)}let o=t;n.width&&(o=o.replace(/<svg([^>]*)\s+width\s*=\s*["'][^"']*["']/gi,"<svg$1"),o=o.replace(/<svg/i,`<svg width="${n.width}"`)),n.height&&(o=o.replace(/<svg([^>]*)\s+height\s*=\s*["'][^"']*["']/gi,"<svg$1"),o=o.replace(/<svg/i,`<svg height="${n.height}"`)),n.title&&(o=o.replace(/<title[^>]*>.*?<\/title>/gi,""),o=o.replace(/<svg([^>]*)>/i,`<svg$1><title>${n.title}</title>`)),a(o),_(!1)}).catch(t=>{t instanceof Error?console.error(`[Icon] ${t.message}`):console.error(`[Icon] ${String(t)}`),c(!0),_(!1)})},[e,n.width,n.height,n.title]),d||l?u("svg",{...n}):u("span",{className:n.className,style:{width:String(n.width),height:String(n.height),display:"inline-flex",lineHeight:0},dangerouslySetInnerHTML:{__html:s}})}function F({source:e,size:n="24",stroke:s="2",viewBox:a="0 0 24 24",className:d,..._}){const l={className:B(["dropin-icon",`dropin-icon--shape-stroke-${s}`,d]),width:n,height:n,viewBox:a},c=typeof e=="string"&&(e.startsWith("http")||e.startsWith("//")||e.startsWith("/"));if(c&&A(e))return u(L,{fallback:u("svg",{..._,...l}),children:u(W,{url:e,..._,...l})});const t=typeof e=="string"&&e in R?R[e]:null,o=c&&!A(e);return u(L,{fallback:u("svg",{..._,...l}),children:t?u(t,{..._,...l}):o?u("svg",{..._,...l}):u(e,{..._,...l})})}const G=({name:e,value:n,size:s="medium",disabled:a=!1,error:d=!1,label:_="",description:l="",className:c,checked:t,...o})=>{const[m,f]=$(t===void 0?!1:t),h=S(null),E=p=>{var g;(g=o.onChange)==null||g.call(o,p),f(p.currentTarget.checked)},y=p=>{var g;p.key===" "&&(p.preventDefault(),(g=h==null?void 0:h.current)==null||g.click())};return T(()=>{typeof t=="boolean"&&f(t)},[t]),P("label",{className:v(["dropin-checkbox",["dropin-checkbox--disabled",a]]),children:[u("input",{ref:h,name:e,value:n,type:"checkbox",disabled:a,className:v(["dropin-checkbox__checkbox",["dropin-checkbox__checkbox--error",d],c]),...o,onChange:E,checked:m}),P("div",{className:"dropin-checkbox__checkbox-icon",children:["â€‹",u("span",{"aria-checked":m?"true":"false","aria-labelledby":`${e}-label`,"aria-describedby":l?`${e}-description`:void 0,className:v(["dropin-checkbox__box",["dropin-checkbox__box--error",d],["dropin-checkbox__box--disabled",a]]),role:"checkbox",tabIndex:a?-1:0,onKeyDown:y,children:u(F,{className:v(["dropin-checkbox__checkmark"]),source:V,size:"16",stroke:"3"})})]}),u("div",{id:`${e}-label`,className:v(["dropin-checkbox__label",`dropin-checkbox__label--${s}`,["dropin-checkbox__label--disabled",a]]),children:_}),u("div",{}),l&&u("div",{id:`${e}-description`,role:"note",className:v(["dropin-checkbox__description",`dropin-checkbox__description--${s}`,["dropin-checkbox__description--disabled",a]]),children:l})]})},D=({className:e,checked:n,name:s,label:a,...d})=>u("div",{...d,className:v(["klaviyocheckoutconsent-klaviyo-checkout-consent-component",e]),children:u(G,{name:s,label:a,checked:n})}),X=({enable_sms_consent:e,enable_email_consent:n,sms_consent_label:s,email_consent_label:a,sms_consent_name:d,email_consent_name:_,checked:l,sms_disclosure:c,...t})=>u("div",{...t,children:P("div",{...t,children:[n&&u(D,{label:a,name:_,checked:l}),e&&P("div",{className:"sms-consent",children:[u(D,{label:s,name:d,checked:l}),u("div",{className:"sms-disclosure",children:c})]})]})}),Y=async(e,n,s,a,d,_,l)=>{let c=await C(e.email,l),t=null,o=null,m=null;if(c.GetProfileByEmail.data.length<=0){let h=I(e,n,null,null,null,!0,m),E=await w(h,l);Object.keys(E.createProfile).length>0&&(t=E.createProfile.data)}else t=c.GetProfileByEmail.data[0];let f=[];if(t&&Object.keys(t.id).length>0&&(o=t.id,Object.keys(t.attributes.phone_number).length>0&&(m=t.attributes.phone_number)),o){if(s){let h=I(e,n,"email",o,a,m);Object.keys(h).length>0&&f.push(h)}if(d){let h=I(e,n,"sms",o,_,m);Object.keys(h).length>0&&f.push(h)}if(f.length)for(const h of f)await x(h,l)}return t},z=e=>{let n=null;return e?String(e).replace(/^(\d)/,"+$1").replace(/^\((?!\+)/,"(+"):n},I=(e,n,s,a,d,_=!1,l)=>{var h,E,y;let c={},t={},o=n.data,m={},f=l??z(o.telephone);return _&&(m={data:{type:"profile",attributes:{email:e.email||null,first_name:o.firstName||null,last_name:o.lastName||null,organization:o.company||null,location:{address1:((h=o.street)==null?void 0:h[0])||null,address2:((E=o.street)==null?void 0:E[1])||null,city:o.city||null,country:o.countryCode||null,region:((y=o.region)==null?void 0:y.regionCode)||null,zip:o.postcode||null}}}}),_||(s==="email"&&a&&(m={data:{type:"profile-subscription-bulk-create-job",attributes:{profiles:{data:[{type:"profile",id:a,attributes:{email:e.email||null}}]}}}},c.email={marketing:{consent:"SUBSCRIBED"}}),s==="sms"&&a&&(m={data:{type:"profile-subscription-bulk-create-job",attributes:{profiles:{data:[{type:"profile",id:a,attributes:{phone_number:f||null}}]}}}},c.sms={marketing:{consent:"SUBSCRIBED"},transactional:{consent:"SUBSCRIBED"}}),a&&Object.keys(c).length>0&&(m.data.attributes.profiles.data[0].attributes.subscriptions=c),d&&(t.list={data:{type:"list",id:d}}),a&&d&&Object.keys(t.list.data).length>0&&(m.data.relationships=t)),m};export{Y as KlaviyoApiCreateUpdate,X as KlaviyoCheckoutConsentContainer,X as default};
//# sourceMappingURL=KlaviyoCheckoutConsentContainer.js.map
